---
layout: post
title: FormData
subtitle: 原生JavaScript学习笔记系列
date: 2019-04-10
author: Jalever
header-img: img/post_2019_react_bg_shadow.jpg
catalog: true
tags:
  - JavaScript
---

## Table of Contents

- [Table of Contents](#table-of-contents)
- [Difinition](#difinition)
- [Constructor](#constructor)
    - [FormData()](#formdata)
        - [Syntax](#syntax)
        - [Example](#example)
- [Methods](#methods)
    - [FormData.append()](#formdataappend)
    - [FormData.delete()](#formdatadelete)
    - [FormData.entries()](#formdataentries)
    - [FormData.get()](#formdataget)
    - [FormData.getAll()](#formdatagetall)
    - [FormData.has()](#formdatahas)
    - [FormData.keys()](#formdatakeys)
    - [FormData.set()](#formdataset)
    - [FormData.values()](#formdatavalues)
- [Usage](#usage)

## Difinition

The `FormData` interface provides a way to easily construct a set of `key/value` pairs representing form fields and their values, which can then be easily sent using the `XMLHttpRequest.send()` method.<br>
It uses the same format a form would use if the encoding type were set to `"multipart/form-data"`.<br>
You can also pass it directly to the `URLSearchParams` constructor if you want to generate query parameters in the way a `<form>` would do if it were using simple `GET` submission.<br>
An object implementing `FormData` can directly be used in a `for...of` structure, instead of `entries()`: `for (var p of myFormData)` is equivalent to `for (var p of myFormData.entries())`.

## Constructor

#### FormData()

The `FormData()` constructor creates a new `FormData` object.

###### Syntax

```javascript
var formData = new FormData(form);
```

- Parameters
  - form
    - optional
    - An `HTML` `<form>` element — when specified, the FormData object will be populated with the form's current keys/values using the name property of each element for the keys and their submitted value for the values.<br>
    - It will also encode file input content.

###### Example

The following line creates an empty `FormData` object, You could add a `key/value` pair to this using `FormData.append`:

```javascript
var formData = new FormData(); // Currently empty
formData.append("username", "Chris");
```

Or you can specify the optional form argument when creating the `FormData` object, to prepopulate it with values from the specified form:

```javascript
<form id="myForm" name="myForm">
  <div>
    <label for="username">Enter name:</label>
    <input type="text" id="username" name="username">
  </div>
  <div>
    <label for="useracc">Enter account number:</label>
    <input type="text" id="useracc" name="useracc">
  </div>
  <div>
    <label for="userfile">Upload file:</label>
    <input type="file" id="userfile" name="userfile">
  </div>
  <input type="submit" value="Submit!">
</form>

let myForm = document.getElementById('myForm');
let formData = new FormData(myForm);
```

> Only successful form controls are included in a `FormData` object, i.e. those with a `name`, `not disabled and checked` (`radio buttons and checkboxes`) or `selected` (one or more options within a select).

## Methods

#### FormData.append()

Appends a new value onto an existing key inside a `FormData` object, or adds the key if it does not already exist.<br>
The difference between `FormData.set` and `append()` is that if the specified key already exists, `FormData.set` will <ins>overwrite all existing values with the new one</ins>, whereas `append()` will <ins>append the new value onto the end of the existing set of values</ins>.

#### FormData.delete()

Deletes a `key/value` pair from a FormData object.

#### FormData.entries()

Returns an iterator allowing to go through all `key/value` pairs contained in this object.

#### FormData.get()

Returns the first `value` associated with a given `key` from within a `FormData` object.

#### FormData.getAll()

Returns an array of all the `values` associated with a given `key` from within a `FormData`.

#### FormData.has()

Returns a boolean stating whether a `FormData` object contains a certain `key`.

#### FormData.keys()

Returns an iterator allowing to go through all `keys` of the `key/value` pairs contained in this object.

#### FormData.set()

Sets a new `value` for an existing `key` inside a `FormData` object, or adds the `key/value` if it does not already exist.

#### FormData.values()

Returns an iterator allowing to go through all `values` contained in this object.

## Usage

在文件`index.jsx`中引用`api.jsx`中的`login`方法

```javascript
let BodyFormData = new FormData();
BodyFormData.set("name", username);
BodyFormData.set("password", password);
BodyFormData.set("appKey", APP_KEY);
BodyFormData.set("isRemember", isChecked);

API.login(BodyFormData).then(res => {
  if (res.data.code === SUCCESS) {
    message.success(res.data.message);

    this.props.addUserInfo(res.data.data);
  } else {
    message.error(res.data.message);
  }
});
```

`api.jsx`中利用`Axios`申请数据

```javascript
const METHOD = {
  GET: "get",
  POST: "post",
  PUT: "put",
  DELETE: "delete"
};

const hydrateAPI = url => BOS_FUNDATION_PREFIX + url;

const request = (
  url,
  params,
  method = "post",
  jsonType = false,
  formType = false
) => {
  let options = {
    headers: {
      "Content-Type": jsonType
        ? "application/json"
        : formType
        ? "multipart/form-data"
        : "application/x-www-form-urlencoded"
    },
    url: url,
    method: method,
    data: params
  };

  console.log("options");
  console.log(options);

  return axios(options);
};

export default {
  login: params =>
    request(hydrateAPI("/account/login"), params, METHOD.POST, true, true)
};
```

---
layout: post
title: 订阅发布模式
subtitle: Behavioral Pattern
date: 2020-03-19
author: Jalever
header-img: img/design_pattern_bg_simple.png
catalog: true
tags:
  - Design Pattern
---
## Definition
Publisher-Subscriber Pattern

## source code
```js
var Observer = {
  sub: function(key, fn) {
    if(!this.list[key]) this.list[key] = [];
    this.list[key].push(fn);
  },
  removeSub: function() {},
  publish: function() {
    let key = Array.prototype.shift.call(arguments),
    fns = this.list[key];
    if(!fns || !fns.length) return false;
    fns.forEach(fn => fn.apply(this, arguments));
  },
  make: function(obj) {
    for(let prop in this) obj[prop] = this[prop];
    obj.list = []
  }
};


var blogger = {
  recommend: function (id) {
      var msg = 'dudu 推荐了的帖子:' + id;
      this.publish('good',msg);
  }
};

var user = {
  vote: function (id) {
      var msg = '有人投票了!ID=' + id;
      this.publish('sad', msg);
  }
};

Observer.make(blogger);
Observer.make(user);


var tom = {
  read: function (what) {
      console.log('Tom看到了如下信息：' + what)
  }
};

var mm = {
  show: function (what) {
      console.log('mm看到了如下信息：' + what)
  }
};
// 订阅
blogger.sub('good',tom.read);
blogger.sub('good',mm.show);
blogger.recommend(123); //调用发布
```

